<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>房屋租售系统 - 管理员页面</title>
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="particles-container">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
</div>
<div class="decoration decoration-1"></div>
<div class="decoration decoration-2"></div>
<header>
    <div class="container">
        <nav>
            <div class="logo">房屋租售系统</div>
            <ul class="nav-links">
                <li><a class="active" href="admin.html">首页</a></li>
                <li><a href="#" onclick="showSection('appointment-manage')">预约管理 <span class="badge">7</span></a>
                </li>
                <li><a href="#" onclick="showSection('house-manage')">房源管理 <span class="badge">3</span></a></li>
                <li><a href="#" onclick="showSection('user-manage')">用户管理 <span class="badge">1</span></a></li>
                <li><span id="username"></span></li>
                <li><a class="btn btn-secondary" href="#" id="logoutBtn">登出</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <!-- 管理员首页 -->
    <section class="section active" id="dashboard">
        <h2 style="margin: 2rem 0;">管理员首页</h2>
        <p>欢迎使用房屋租售系统管理员后台</p>
    </section>

    <!-- 预约管理 -->
    <section class="section" id="appointment-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">预约管理</h2>

        <div class="card">
            <div class="card-body">
                <table class="table" id="appointmentTable">
                    <thead>
                    <tr>
                        <th>订单ID</th>
                        <th>房源</th>
                        <th>租客</th>
                        <th>房东</th>
                        <th>预约时间</th>
                        <th>预约地点</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 预约数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 房源管理 -->
    <section class="section" id="house-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">房源管理</h2>

        <div class="filter-container" style="margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem;">
                <input id="houseSearch" placeholder="搜索房源标题或地址" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 300px;" type="text">
                <button class="btn" onclick="searchHouses()">搜索</button>
                <button class="btn btn-secondary" onclick="resetHouseSearch()">重置</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <table class="table" id="houseTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>标题</th>
                        <th>户型</th>
                        <th>面积</th>
                        <th>价格</th>
                        <th>地址</th>
                        <th>房东</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 房源数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 用户管理 -->
    <section class="section" id="user-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">用户管理</h2>

        <div class="filter-container" style="margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem;">
                <input id="userSearch" placeholder="搜索用户名" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 300px;" type="text">
                <select id="userRole" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">全部角色</option>
                    <option value="tenant">租客</option>
                    <option value="landlord">房东</option>
                    <option value="admin">管理员</option>
                </select>
                <button class="btn" onclick="searchUsers()">搜索</button>
                <button class="btn btn-secondary" onclick="resetUserSearch()">重置</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <table class="table" id="userTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>角色</th>
                        <th>注册时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 用户数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 统计分析 -->
    <section class="section" id="statistics" style="display: none;">
        <h2 style="margin: 2rem 0;">统计分析</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div class="card">
                <div class="card-header">
                    <h3>收藏数量排行表</h3>
                </div>
                <div class="card-body">
                    <table class="table" id="favoriteRanking">
                        <thead>
                        <tr>
                            <th>排名</th>
                            <th>房源</th>
                            <th>收藏数</th>
                            <th>房东</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- 收藏排行数据将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>用户角色分布</h3>
                </div>
                <div class="card-body">
                    <div id="roleDistribution" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <!-- 角色分布图表将通过JavaScript动态生成 -->
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; margin-bottom: 1rem;">租客：65%</div>
                            <div style="font-size: 1.2rem; margin-bottom: 1rem;">房东：30%</div>
                            <div style="font-size: 1.2rem;">管理员：5%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <h3>房源类型分布</h3>
            </div>
            <div class="card-body">
                <div id="houseTypeDistribution" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                    <!-- 房源类型分布图表将通过JavaScript动态生成 -->
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">平层：45%</div>
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">跃层：20%</div>
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">错层：15%</div>
                        <div style="font-size: 1.2rem;">复式：20%</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script src="assets/js/utils.js"></script>
<script>
    // 管理员页面JS
    function initAdminPage() {
        // 获取当前用户信息
        const userStr = localStorage.getItem('user');
        if (userStr) {
            const user = JSON.parse(userStr);
            if (user && user.id) {
                document.getElementById('username').textContent = user.username;
            } else {
                // 用户信息无效
                console.error("用户 ID 无效或不存在");
                alert("用户信息无效，请重新登录");
                // 清除无效的用户信息并重定向到登录页面
                localStorage.removeItem('user');
                localStorage.removeItem('token');
                window.location.href = "/login.html";  // 重定向到登录页面
                return; // 立即返回，不继续执行后续初始化
            }
        } else {
            // 未找到用户信息
            console.error("未找到用户信息");
            alert("未找到用户信息，请重新登录");
            window.location.href = "/login.html";  // 强制跳转到登录页面
            return; // 立即返回，不继续执行后续初始化
        }

        // 初始化预约管理
        initAppointmentManage();

        // 初始化房源管理
        initHouseManage();

        // 初始化用户管理
        initUserManage();
    }

    // 初始化预约管理
    function initAppointmentManage() {
        // 显示加载进度条
        showProgressBar();
        
        // 模拟预约数据
        const appointments = [
            {
                id: 1,
                house: '阳光小区 3室2厅',
                tenant: '张三',
                landlord: '房东A',
                time: '2025-12-01 14:00',
                location: '小区门口',
                status: '已批准'
            },
            {
                id: 2,
                house: '幸福家园 2室1厅',
                tenant: '李四',
                landlord: '房东B',
                time: '2025-12-02 10:00',
                location: '单元门口',
                status: '待处理'
            }
        ];

        const tbody = document.getElementById('appointmentTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = appointments.map(appointment => `
            <tr>
                <td>${appointment.id}</td>
                <td>${appointment.house}</td>
                <td>${appointment.tenant}</td>
                <td>${appointment.landlord}</td>
                <td>${appointment.time}</td>
                <td>${appointment.location}</td>
                <td>${appointment.status}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteAppointment(${appointment.id})">删除</button>
                </td>
            </tr>
        `).join('');

        // 隐藏加载进度条
        setTimeout(() => {
            hideProgressBar();
        }, 500);
    }

    // 初始化房源管理
    function initHouseManage() {
        // 显示加载进度条
        showProgressBar();
        
        // 模拟房源数据
        const houses = [
            {
                id: 1,
                title: '阳光小区 3室2厅',
                type: '平层',
                area: 120,
                price: 3500,
                address: '北京市朝阳区阳光路1号',
                landlord: '房东A'
            },
            {
                id: 2,
                title: '幸福家园 2室1厅',
                type: '跃层',
                area: 85,
                price: 2800,
                address: '北京市海淀区幸福路2号',
                landlord: '房东B'
            }
        ];

        const tbody = document.getElementById('houseTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = houses.map(house => `
            <tr>
                <td>${house.id}</td>
                <td>${house.title}</td>
                <td>${house.type}</td>
                <td>${house.area}㎡</td>
                <td>¥${house.price}/月</td>
                <td>${house.address}</td>
                <td>${house.landlord}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteHouse(${house.id})">删除</button>
                </td>
            </tr>
        `).join('');

        // 隐藏加载进度条
        setTimeout(() => {
            hideProgressBar();
        }, 500);
    }

    // 初始化用户管理
    function initUserManage() {
        // 显示加载进度条
        showProgressBar();
        
        // 模拟用户数据
        const users = [
            {id: 1, username: 'user1', role: 'tenant', registerTime: '2025-11-01 10:00', status: '正常'},
            {id: 2, username: 'user2', role: 'landlord', registerTime: '2025-11-02 14:30', status: '正常'}
        ];

        const tbody = document.getElementById('userTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = users.map(user => `
            <tr>
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td>${user.role === 'tenant' ? '租客' : user.role === 'landlord' ? '房东' : '管理员'}</td>
                <td>${user.registerTime}</td>
                <td>${user.status}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">删除</button>
                </td>
            </tr>
        `).join('');

        // 隐藏加载进度条
        setTimeout(() => {
            hideProgressBar();
        }, 500);
    }

    // 删除预约
    function deleteAppointment(appointmentId) {
        showMessage('预约已删除', 'success');
    }

    // 删除房源
    function deleteHouse(houseId) {
        showMessage('房源已删除', 'success');
    }

    // 删除用户
    function deleteUser(userId) {
        showMessage('用户已删除', 'success');
    }

    // 搜索房源
    function searchHouses() {
        const keyword = document.getElementById('houseSearch').value;
        showMessage(`搜索房源：${keyword}`, 'success');
    }

    // 重置房源搜索
    function resetHouseSearch() {
        document.getElementById('houseSearch').value = '';
        initHouseManage();
    }

    // 搜索用户
    function searchUsers() {
        const keyword = document.getElementById('userSearch').value;
        const role = document.getElementById('userRole').value;
        showMessage(`搜索用户：${keyword}，角色：${role}`, 'success');
    }

    // 重置用户搜索
    function resetUserSearch() {
        document.getElementById('userSearch').value = '';
        document.getElementById('userRole').value = '';
        initUserManage();
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
        initAdminPage();
        
        // 登出按钮事件
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
        }
    });
</script>
</body>
</html>