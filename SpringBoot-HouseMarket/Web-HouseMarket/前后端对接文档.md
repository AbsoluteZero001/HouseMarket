# 房屋租售系统 - 前后端对接文档

## 1. 文档说明

### 1.1 文档目的
本文档旨在规范房屋租售系统前后端接口设计，确保前后端开发者能够高效协作，减少沟通成本，提高开发效率。

### 1.2 术语定义
| 术语 | 说明 |
|------|------|
| 租客 | 租房用户 |
| 房东 | 出租房屋的用户 |
| 管理员 | 系统管理员 |
| 预约 | 租客预约看房 |
| 收藏 | 租客收藏房源 |

## 2. 接口规范

### 2.1 基础URL
```
http://localhost:8082/api/v1
```

### 2.2 请求方法
- GET：获取资源
- POST：创建资源
- PUT：更新资源
- DELETE：删除资源

### 2.3 请求头
| 字段名 | 类型 | 说明 |
|--------|------|------|
| Content-Type | string | 资源类型，默认为 application/json |
| Authorization | string | Bearer Token，用于身份验证 |

### 2.4 响应格式
```json
{
  "code": 200,
  "msg": "成功",
  "data": {...}
}
```

### 2.5 错误码定义
| 错误码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |
| 501 | 接口未实现 |

## 3. 接口列表

### 3.1 认证接口

#### 3.1.1 登录接口
- **URL**: `/auth/login`
- **方法**: POST
- **请求参数**:
  ```json
  {
    "username": "string", // 用户名
    "password": "string", // 密码
    "role": "string" // 角色（tenant/landlord/admin）
  }
  ```
- **响应示例**:
  ```json
  {
    "code": 200,
    "msg": "登录成功",
    "data": {
      "token": "string",
      "user": {
        "id": 1,
        "username": "string",
        "role": "string"
      }
    }
  }
  ```

#### 3.1.2 注册接口
- **URL**: `/auth/register`
- **方法**: POST
- **请求参数**:
  ```json
  {
    "username": "string",
    "password": "string",
    "role": "string" // tenant/landlord
  }
  ```

### 3.2 房源接口

#### 3.2.1 获取房源列表
- **URL**: `/houses`
- **方法**: GET
- **查询参数**:
  - keyword: 关键词
  - type: 户型
  - minArea: 最小面积
  - maxArea: 最大面积
  - minPrice: 最低价格
  - maxPrice: 最高价格
  - address: 地址
  - page: 页码
  - pageSize: 每页数量

#### 3.2.2 获取房源详情
- **URL**: `/houses/{id}`
- **方法**: GET

#### 3.2.3 发布房源
- **URL**: `/houses`
- **方法**: POST
- **请求参数**:
  ```json
  {
    "title": "string",
    "type": "string",
    "area": 100,
    "price": 3500,
    "address": "string",
    "description": "string",
    "image": "string" // Base64编码的图片
  }
  ```

#### 3.2.4 更新房源
- **URL**: `/houses/{id}`
- **方法**: PUT

#### 3.2.5 删除房源
- **URL**: `/houses/{id}`
- **方法**: DELETE

### 3.3 预约接口

#### 3.3.1 创建预约
- **URL**: `/appointments`
- **方法**: POST
- **请求参数**:
  ```json
  {
    "houseId": 1,
    "time": "2025-12-01 14:00:00",
    "location": "string",
    "notes": "string"
  }
  ```

#### 3.3.2 获取我的预约
- **URL**: `/appointments`
- **方法**: GET

#### 3.3.3 处理预约
- **URL**: `/appointments/{id}`
- **方法**: PUT
- **请求参数**:
  ```json
  {
    "status": "approved/rejected" // 处理状态
  }
  ```

### 3.4 收藏接口

#### 3.4.1 切换收藏状态
- **URL**: `/favorites/{houseId}`
- **方法**: POST

#### 3.4.2 获取收藏列表
- **URL**: `/favorites`
- **方法**: GET

## 4. 数据模型

### 4.1 用户模型
```json
{
  "id": 1,
  "username": "string",
  "password": "string",
  "role": "string",
  "status": "string",
  "createTime": "string"
}
```

### 4.2 房源模型
```json
{
  "id": 1,
  "title": "string",
  "type": "string",
  "area": 100,
  "price": 3500,
  "address": "string",
  "description": "string",
  "image": "string",
  "landlordId": 1,
  "status": "string",
  "createTime": "string"
}
```

### 4.3 预约模型
```json
{
  "id": 1,
  "houseId": 1,
  "tenantId": 1,
  "landlordId": 1,
  "time": "string",
  "location": "string",
  "notes": "string",
  "status": "pending/approved/rejected",
  "createTime": "string"
}
```

### 4.4 收藏模型
```json
{
  "id": 1,
  "houseId": 1,
  "userId": 1,
  "createTime": "string"
}
```

## 5. 前后端协作流程

### 5.1 开发流程
1. 前端根据文档设计页面
2. 后端根据文档实现接口
3. 前后端联调测试
4. 接口优化和迭代

### 5.2 常见问题处理
- 接口变更需提前通知
- 接口返回数据结构需保持稳定
- 错误码需统一管理

## 6. 示例代码

### 6.1 前端请求示例
```javascript
async function login() {
  const response = await fetch('http://localhost:8082/api/v1/auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      username: 'test',
      password: '123456',
      role: 'tenant'
    })
  });
  
  const result = await response.json();
  if (result.code === 200) {
    localStorage.setItem('token', result.data.token);
  }
}
```

### 6.2 后端响应示例
```java
// Java Spring Boot示例
@RestController
@RequestMapping("/api/v1/auth")
public class AuthController {
  @PostMapping("/login")
  public ResponseEntity<?> login(@RequestBody LoginDto dto) {
    // 验证逻辑
    return ResponseEntity.ok(Response.ok(token, user));
  }
}
```

## 7. 附录

### 7.1 状态码说明
| 状态 | 说明 |
|------|------|
| pending | 待处理 |
| approved | 已批准 |
| rejected | 已拒绝 |
| active | 正常 |
| disabled | 禁用 |

### 7.2 户型说明
| 类型 | 说明 |
|------|------|
| 平层 | 普通平层 |
| 跃层 | 上下两层，无楼梯 |
| 错层 | 不同功能区高度不同 |
| 复式 | 上下两层，有楼梯 |

---

**版本历史**

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| V1.0 | 2025-12-20 | 初始版本 | 系统自动生成 |