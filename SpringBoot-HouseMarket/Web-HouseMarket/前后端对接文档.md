# 房屋租售系统 - 前后端对接文档

## 1. 项目概述

本项目是一个房屋租售系统，主要功能包括用户注册登录、房源管理、预约看房、预约记录管理和统计分析等。前端使用HTML、CSS、JavaScript开发，后端需要提供RESTful
API接口供前端调用。

## 2. 技术栈

- **前端**：HTML5、CSS3、JavaScript (ES6+)
- **后端**：建议使用Node.js + Express 或 Python + Django/Flask 或 Java + Spring Boot
- **数据库**：MySQL 或 MongoDB
- **认证**：JWT (JSON Web Token)

## 3. API接口设计

### 3.1 认证相关接口

#### 3.1.1 用户注册

- **URL**：`/api/register`
- **方法**：`POST`
- **请求体**：
  ```json
  {
    "username": "string",
    "password": "string",
    "role": "string"  // tenant(租客) 或 landlord(房东)
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "注册成功",
    "data": {
      "id": 1,
      "username": "string",
      "role": "string"
    }
  }
  ```

#### 3.1.2 用户登录

- **URL**：`/api/login`
- **方法**：`POST`
- **请求体**：
  ```json
  {
    "username": "string",
    "password": "string",
    "role": "string"  // tenant(租客) 或 landlord(房东) 或 admin(管理员)
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "登录成功",
    "data": {
      "token": "jwt-token",
      "user": {
        "id": 1,
        "username": "string",
        "role": "string"
      }
    }
  }
  ```

### 3.2 用户管理接口

#### 3.2.1 获取用户信息

- **URL**：`/api/user/profile`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "username": "string",
      "role": "string",
      "registerTime": "2025-11-01 10:00:00"
    }
  }
  ```

#### 3.2.2 更新用户信息

- **URL**：`/api/user/profile`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求体**：
  ```json
  {
    "password": "string"  // 可选，不修改密码则不传
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "个人信息已更新"
  }
  ```

### 3.3 房源管理接口

#### 3.3.1 获取房源列表

- **URL**：`/api/houses`
- **方法**：`GET`
- **请求参数**：
    - `keyword`：关键词搜索
    - `type`：户型（平层、跃层、错层、复式）
    - `minArea`：最小面积
    - `maxArea`：最大面积
    - `minPrice`：最低价格
    - `maxPrice`：最高价格
    - `address`：地址
    - `page`：页码（默认1）
    - `pageSize`：每页数量（默认10）
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "houses": [
        {
          "id": 1,
          "title": "string",
          "type": "string",
          "area": 120,
          "price": 3500,
          "address": "string",
          "image": "string",
          "description": "string",
          "landlordId": 1,
          "landlordName": "string",
          "createTime": "2025-11-01 10:00:00"
        }
      ],
      "total": 100,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

#### 3.3.2 获取房源详情

- **URL**：`/api/houses/:id`
- **方法**：`GET`
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "id": 1,
      "title": "string",
      "type": "string",
      "area": 120,
      "price": 3500,
      "address": "string",
      "image": "string",
      "description": "string",
      "landlordId": 1,
      "landlordName": "string",
      "createTime": "2025-11-01 10:00:00"
    }
  }
  ```

#### 3.3.3 创建房源

- **URL**：`/api/houses`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求体**：
  ```json
  {
    "title": "string",
    "type": "string",
    "area": 120,
    "price": 3500,
    "address": "string",
    "image": "string",  // Base64编码的图片或图片URL
    "description": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "房源创建成功",
    "data": {
      "id": 1
    }
  }
  ```

#### 3.3.4 更新房源

- **URL**：`/api/houses/:id`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求体**：
  ```json
  {
    "title": "string",
    "type": "string",
    "area": 120,
    "price": 3500,
    "address": "string",
    "image": "string",  // 可选
    "description": "string"
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "房源更新成功"
  }
  ```

#### 3.3.5 删除房源

- **URL**：`/api/houses/:id`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "message": "房源删除成功"
  }
  ```

### 3.4 预约管理接口

#### 3.4.1 创建预约

- **URL**：`/api/appointments`
- **方法**：`POST`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求体**：
  ```json
  {
    "houseId": 1,
    "time": "2025-12-01 14:00:00",
    "location": "string",
    "notes": "string"  // 可选
  }
  ```
- **响应**：
  ```json
  {
    "success": true,
    "message": "预约提交成功，请等待房东确认",
    "data": {
      "id": 1
    }
  }
  ```

#### 3.4.2 获取预约列表

- **URL**：`/api/appointments`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求参数**：
    - `status`：预约状态（pending(待处理)、approved(已批准)、rejected(已拒绝)、completed(已完成)、canceled(已取消)）
    - `page`：页码（默认1）
    - `pageSize`：每页数量（默认10）
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "appointments": [
        {
          "id": 1,
          "houseId": 1,
          "houseTitle": "string",
          "tenantId": 1,
          "tenantName": "string",
          "landlordId": 1,
          "landlordName": "string",
          "time": "2025-12-01 14:00:00",
          "location": "string",
          "notes": "string",
          "status": "string",
          "createTime": "2025-11-20 10:00:00"
        }
      ],
      "total": 50,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

#### 3.4.3 批准预约

- **URL**：`/api/appointments/:id/approve`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "message": "预约已批准"
  }
  ```

#### 3.4.4 拒绝预约

- **URL**：`/api/appointments/:id/reject`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "message": "预约已拒绝"
  }
  ```

#### 3.4.5 取消预约

- **URL**：`/api/appointments/:id/cancel`
- **方法**：`PUT`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "message": "预约已取消"
  }
  ```

#### 3.4.6 删除预约

- **URL**：`/api/appointments/:id`
- **方法**：`DELETE`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "message": "预约已删除"
  }
  ```

### 3.5 统计相关接口

#### 3.5.1 获取仪表盘数据

- **URL**：`/api/statistics/dashboard`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer jwt-token`
- **响应**：
  ```json
  {
    "success": true,
    "data": {
      "totalUsers": 125,
      "totalHouses": 89,
      "totalAppointments": 234,
      "pendingAppointments": 15
    }
  }
  ```

#### 3.5.2 获取收藏数量排行

- **URL**：`/api/statistics/favorite-ranking`
- **方法**：`GET`
- **请求头**：`Authorization: Bearer jwt-token`
- **请求参数**：
    - `limit`：返回数量（默认10）
- **响应**：
  ```json
  {
    "success": true,
    "data": [
      {
        "rank": 1,
        "houseId": 1,
        "houseTitle": "string",
        "favorites": 25,
        "landlordName": "string"
      }
    ]
  }
  ```

## 4. 数据模型设计

### 4.1 用户表 (users)

| 字段名          | 类型           | 描述                          |
|--------------|--------------|-----------------------------|
| id           | INT          | 用户ID，主键，自增                  |
| username     | VARCHAR(50)  | 用户名，唯一                      |
| password     | VARCHAR(100) | 密码，加密存储                     |
| role         | VARCHAR(20)  | 用户角色（tenant/landlord/admin） |
| registerTime | DATETIME     | 注册时间                        |
| status       | VARCHAR(20)  | 用户状态（正常/禁用）                 |

### 4.2 房源表 (houses)

| 字段名         | 类型           | 描述              |
|-------------|--------------|-----------------|
| id          | INT          | 房源ID，主键，自增      |
| title       | VARCHAR(100) | 房源标题            |
| type        | VARCHAR(20)  | 户型（平层/跃层/错层/复式） |
| area        | FLOAT        | 面积              |
| price       | INT          | 价格（元/月）         |
| address     | VARCHAR(200) | 地址              |
| image       | VARCHAR(200) | 图片URL           |
| description | TEXT         | 房源描述            |
| landlordId  | INT          | 房东ID，外键关联users表 |
| createTime  | DATETIME     | 创建时间            |
| updateTime  | DATETIME     | 更新时间            |

### 4.3 预约表 (appointments)

| 字段名        | 类型           | 描述                                                 |
|------------|--------------|----------------------------------------------------|
| id         | INT          | 预约ID，主键，自增                                         |
| houseId    | INT          | 房源ID，外键关联houses表                                   |
| tenantId   | INT          | 租客ID，外键关联users表                                    |
| landlordId | INT          | 房东ID，外键关联users表                                    |
| time       | DATETIME     | 预约时间                                               |
| location   | VARCHAR(200) | 预约地点                                               |
| notes      | TEXT         | 备注                                                 |
| status     | VARCHAR(20)  | 预约状态（pending/approved/rejected/completed/canceled） |
| createTime | DATETIME     | 创建时间                                               |
| updateTime | DATETIME     | 更新时间                                               |

### 4.4 收藏表 (favorites)

| 字段名        | 类型       | 描述               |
|------------|----------|------------------|
| id         | INT      | 收藏ID，主键，自增       |
| userId     | INT      | 用户ID，外键关联users表  |
| houseId    | INT      | 房源ID，外键关联houses表 |
| createTime | DATETIME | 收藏时间             |

## 5. 前后端交互流程

### 5.1 用户登录流程

1. 前端用户输入用户名、密码和角色
2. 前端调用`/api/login`接口
3. 后端验证用户信息，生成JWT token
4. 前端保存token到localStorage
5. 前端根据用户角色跳转到相应页面

### 5.2 房源发布流程

1. 房东登录后，进入房源管理页面
2. 点击"发布新房源"按钮
3. 填写房源信息，包括标题、户型、面积、价格、地址和图片等
4. 前端调用`/api/houses`接口创建房源
5. 后端保存房源信息到数据库
6. 前端显示发布成功消息，并刷新房源列表

### 5.3 预约看房流程

1. 租客浏览房源列表，选择心仪房源
2. 点击"预约看房"按钮
3. 填写预约时间和地点
4. 前端调用`/api/appointments`接口创建预约
5. 后端保存预约信息到数据库，状态为"待处理"
6. 房东登录后，在预约记录页面看到待处理预约
7. 房东点击"批准"或"拒绝"按钮
8. 前端调用相应接口更新预约状态
9. 后端更新预约状态
10. 租客可以在预约记录页面查看预约状态

## 6. 开发规范和注意事项

### 6.1 接口规范

- 所有接口返回格式统一，包含`success`、`message`和`data`字段
- 使用HTTP状态码表示请求结果：
    - 200：成功
    - 400：请求参数错误
    - 401：未授权
    - 403：禁止访问
    - 404：资源不存在
    - 500：服务器内部错误

### 6.2 安全规范

- 密码必须加密存储（建议使用bcrypt算法）
- 使用JWT进行身份认证，token有效期建议设置为7天
- 敏感接口必须验证用户身份和权限
- 防止SQL注入和XSS攻击
- 图片上传需要验证文件类型和大小

### 6.3 性能优化

- 接口返回数据按需返回，避免返回不必要的字段
- 对查询接口添加分页支持
- 对频繁访问的数据进行缓存
- 优化数据库查询，添加适当的索引

### 6.4 错误处理

- 后端需要对所有可能的错误进行捕获和处理
- 返回清晰的错误信息，便于前端调试
- 前端需要对接口返回的错误进行友好提示

## 7. 前端调用示例

```javascript
// 登录示例
async function login(username, password, role) {
    try {
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username,
                password,
                role
            })
        });

        const result = await response.json();
        if (result.success) {
            // 保存token和用户信息
            localStorage.setItem('token', result.data.token);
            localStorage.setItem('user', JSON.stringify(result.data.user));

            // 跳转到相应页面
            if (role === 'tenant') {
                window.location.href = 'tenant.html';
            } else if (role === 'landlord') {
                window.location.href = 'landlord.html';
            } else if (role === 'admin') {
                window.location.href = 'admin.html';
            }
        } else {
            alert(result.message);
        }
    } catch (error) {
        console.error('登录失败:', error);
        alert('登录失败，请稍后重试');
    }
}

// 带认证的请求示例
async function fetchWithAuth(url, options = {}) {
    const token = localStorage.getItem('token');
    const headers = {
        'Content-Type': 'application/json',
        ...options.headers
    };

    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }

    const response = await fetch(url, {
        ...options,
        headers
    });

    return response.json();
}

// 获取房源列表示例
async function getHouses(filters) {
    const queryParams = new URLSearchParams(filters).toString();
    const result = await fetchWithAuth(`/api/houses?${queryParams}`);
    if (result.success) {
        // 处理房源数据
        return result.data.houses;
    } else {
        alert(result.message);
        return [];
    }
}
```

## 8. 部署建议

- 前端和后端建议分开部署
- 前端可以部署到Nginx或CDN
- 后端建议使用PM2（Node.js）或Docker进行部署
- 数据库建议使用云数据库服务
- 配置HTTPS，确保数据传输安全

## 9. 测试建议

- 后端需要编写单元测试和集成测试
- 前端需要进行功能测试和兼容性测试
- 使用Postman或Insomnia测试API接口
- 建议使用CI/CD工具进行自动化测试和部署

## 10. 文档维护

- 接口变更时，需要及时更新文档
- 建议使用Swagger或Postman自动生成API文档
- 保持文档的清晰性和完整性

以上是房屋租售系统的前后端对接文档，希望对后端开发同学有所帮助。如有疑问或需要进一步说明，请随时联系前端开发同学。