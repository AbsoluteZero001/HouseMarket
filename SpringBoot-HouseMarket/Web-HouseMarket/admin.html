<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>房屋租售系统 - 管理员页面</title>
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="container">
        <nav>
            <div class="logo">房屋租售系统</div>
            <ul class="nav-links">
                <li><a class="active" href="admin.html">首页</a></li>
                <li><a href="#" onclick="showSection('appointment-manage')">预约管理</a></li>
                <li><a href="#" onclick="showSection('house-manage')">房源管理</a></li>
                <li><a href="#" onclick="showSection('user-manage')">用户管理</a></li>
                <li><span id="username"></span></li>
                <li><a class="btn btn-secondary" href="#" id="logoutBtn">登出</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <!-- 管理员首页 -->
    <section class="section active" id="dashboard">
        <h2 style="margin: 2rem 0;">管理员首页</h2>
        <p>欢迎使用房屋租售系统管理员后台</p>
    </section>

    <!-- 预约管理 -->
    <section class="section" id="appointment-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">预约管理</h2>

        <div class="card">
            <div class="card-body">
                <table class="table" id="appointmentTable">
                    <thead>
                    <tr>
                        <th>订单ID</th>
                        <th>房源</th>
                        <th>租客</th>
                        <th>房东</th>
                        <th>预约时间</th>
                        <th>预约地点</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 预约数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 房源管理 -->
    <section class="section" id="house-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">房源管理</h2>

        <div class="filter-container" style="margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem;">
                <input id="houseSearch" placeholder="搜索房源标题或地址" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 300px;"
                       type="text">
                <button class="btn" onclick="searchHouses()">搜索</button>
                <button class="btn btn-secondary" onclick="resetHouseSearch()">重置</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <table class="table" id="houseTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>标题</th>
                        <th>户型</th>
                        <th>面积</th>
                        <th>价格</th>
                        <th>地址</th>
                        <th>房东</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 房源数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 用户管理 -->
    <section class="section" id="user-manage" style="display: none;">
        <h2 style="margin: 2rem 0;">用户管理</h2>

        <div class="filter-container" style="margin-bottom: 1.5rem;">
            <div style="display: flex; gap: 1rem;">
                <input id="userSearch" placeholder="搜索用户名" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; width: 300px;"
                       type="text">
                <select id="userRole" style="padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">全部角色</option>
                    <option value="tenant">租客</option>
                    <option value="landlord">房东</option>
                    <option value="admin">管理员</option>
                </select>
                <button class="btn" onclick="searchUsers()">搜索</button>
                <button class="btn btn-secondary" onclick="resetUserSearch()">重置</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <table class="table" id="userTable">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>角色</th>
                        <th>注册时间</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 用户数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- 统计分析 -->
    <section class="section" id="statistics" style="display: none;">
        <h2 style="margin: 2rem 0;">统计分析</h2>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
            <div class="card">
                <div class="card-header">
                    <h3>收藏数量排行表</h3>
                </div>
                <div class="card-body">
                    <table class="table" id="favoriteRanking">
                        <thead>
                        <tr>
                            <th>排名</th>
                            <th>房源</th>
                            <th>收藏数</th>
                            <th>房东</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- 收藏排行数据将通过JavaScript动态生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>用户角色分布</h3>
                </div>
                <div class="card-body">
                    <div id="roleDistribution"
                         style="height: 300px; display: flex; align-items: center; justify-content: center;">
                        <!-- 角色分布图表将通过JavaScript动态生成 -->
                        <div style="text-align: center;">
                            <div style="font-size: 1.2rem; margin-bottom: 1rem;">租客：65%</div>
                            <div style="font-size: 1.2rem; margin-bottom: 1rem;">房东：30%</div>
                            <div style="font-size: 1.2rem;">管理员：5%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <h3>房源类型分布</h3>
            </div>
            <div class="card-body">
                <div id="houseTypeDistribution"
                     style="height: 300px; display: flex; align-items: center; justify-content: center;">
                    <!-- 房源类型分布图表将通过JavaScript动态生成 -->
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">平层：45%</div>
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">跃层：20%</div>
                        <div style="font-size: 1.2rem; margin-bottom: 1rem;">错层：15%</div>
                        <div style="font-size: 1.2rem;">复式：20%</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    // 验证码生成函数
    function generateCaptcha() {
        const canvas = document.getElementById('captchaCanvas');
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        const width = canvas.width;
        const height = canvas.height;

        // 清空画布
        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(0, 0, width, height);

        // 生成随机验证码
        const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
        let captcha = '';
        for (let i = 0; i < 4; i++) {
            captcha += chars.charAt(Math.floor(Math.random() * chars.length));
        }

        // 绘制验证码
        ctx.font = '30px Arial';
        ctx.fillStyle = '#333';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // 添加干扰线
        for (let i = 0; i < 5; i++) {
            ctx.strokeStyle = `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`;
            ctx.beginPath();
            ctx.moveTo(Math.random() * width, Math.random() * height);
            ctx.lineTo(Math.random() * width, Math.random() * height);
            ctx.stroke();
        }

        // 添加干扰点
        for (let i = 0; i < 30; i++) {
            ctx.fillStyle = `rgb(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255})`;
            ctx.beginPath();
            ctx.arc(Math.random() * width, Math.random() * height, 1, 0, Math.PI * 2);
            ctx.fill();
        }

        // 绘制验证码文本
        for (let i = 0; i < captcha.length; i++) {
            const x = (width / 4) * (i + 0.5);
            const y = height / 2 + (Math.random() - 0.5) * 10;
            const rotation = (Math.random() - 0.5) * 0.5;

            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.fillText(captcha.charAt(i), 0, 0);
            ctx.restore();
        }

        // 保存验证码到sessionStorage
        sessionStorage.setItem('captcha', captcha.toLowerCase());
    }

    // 表单验证函数
    function validateForm(formId) {
        const form = document.getElementById(formId);
        if (!form) return false;

        const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        let isValid = true;

        inputs.forEach(input => {
            if (!input.value.trim()) {
                isValid = false;
                input.style.borderColor = '#dc3545';
                input.addEventListener('input', () => {
                    input.style.borderColor = '#ddd';
                });
            }
        });

        return isValid;
    }

    // 显示消息函数
    function showMessage(message, type = 'success') {
        const messageDiv = document.createElement('div');
        messageDiv.className = `alert alert-${type}`;
        messageDiv.textContent = message;

        // 添加到页面顶部
        document.body.insertBefore(messageDiv, document.body.firstChild);

        // 3秒后移除
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    // 图片预览功能
    function initImagePreview(inputId, previewId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);

        if (input && preview) {
            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        preview.src = event.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    }

    // 模态框控制
    function showModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'block';
        }
    }

    function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
        }
    }

    // 关闭模态框事件监听
    function initModals() {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            const closeBtn = modal.querySelector('.close');
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });
            }

            // 点击模态框外部关闭
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    }

    // 登出函数
    function logout() {
        // 清除用户数据
        localStorage.removeItem('token');
        localStorage.removeItem('user');

        showMessage('已成功登出', 'success');

        // 跳转到登录页
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 1500);
    }

    // 初始化所有工具函数
    document.addEventListener('DOMContentLoaded', () => {
        // 生成验证码
        if (document.getElementById('captchaCanvas')) {
            generateCaptcha();
            // 点击刷新验证码
            document.getElementById('captchaCanvas').addEventListener('click', generateCaptcha);
        }

        // 初始化模态框
        initModals();

        // 登出按钮事件
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
        }
    });
</script>
<script>
    // 管理员页面JS
    function initAdminPage() {
        // 初始化预约管理
        initAppointmentManage();

        // 初始化房源管理
        initHouseManage();

        // 初始化用户管理
        initUserManage();
    }

    // 初始化预约管理
    function initAppointmentManage() {
        // 模拟预约数据
        const appointments = [
            {
                id: 1,
                house: '阳光小区 3室2厅',
                tenant: '张三',
                landlord: '房东A',
                time: '2025-12-01 14:00',
                location: '小区门口',
                status: '已批准'
            },
            {
                id: 2,
                house: '幸福家园 2室1厅',
                tenant: '李四',
                landlord: '房东B',
                time: '2025-12-02 10:00',
                location: '单元门口',
                status: '待处理'
            }
        ];

        const tbody = document.getElementById('appointmentTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = appointments.map(appointment => `
            <tr>
                <td>${appointment.id}</td>
                <td>${appointment.house}</td>
                <td>${appointment.tenant}</td>
                <td>${appointment.landlord}</td>
                <td>${appointment.time}</td>
                <td>${appointment.location}</td>
                <td>${appointment.status}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteAppointment(${appointment.id})">删除</button>
                </td>
            </tr>
        `).join('');
    }

    // 初始化房源管理
    function initHouseManage() {
        // 模拟房源数据
        const houses = [
            {
                id: 1,
                title: '阳光小区 3室2厅',
                type: '平层',
                area: 120,
                price: 3500,
                address: '北京市朝阳区阳光路1号',
                landlord: '房东A'
            },
            {
                id: 2,
                title: '幸福家园 2室1厅',
                type: '跃层',
                area: 85,
                price: 2800,
                address: '北京市海淀区幸福路2号',
                landlord: '房东B'
            }
        ];

        const tbody = document.getElementById('houseTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = houses.map(house => `
            <tr>
                <td>${house.id}</td>
                <td>${house.title}</td>
                <td>${house.type}</td>
                <td>${house.area}㎡</td>
                <td>¥${house.price}/月</td>
                <td>${house.address}</td>
                <td>${house.landlord}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteHouse(${house.id})">删除</button>
                </td>
            </tr>
        `).join('');
    }

    // 初始化用户管理
    function initUserManage() {
        // 模拟用户数据
        const users = [
            {id: 1, username: 'user1', role: 'tenant', registerTime: '2025-11-01 10:00', status: '正常'},
            {id: 2, username: 'user2', role: 'landlord', registerTime: '2025-11-02 14:30', status: '正常'}
        ];

        const tbody = document.getElementById('userTable').getElementsByTagName('tbody')[0];
        tbody.innerHTML = users.map(user => `
            <tr>
                <td>${user.id}</td>
                <td>${user.username}</td>
                <td>${user.role === 'tenant' ? '租客' : user.role === 'landlord' ? '房东' : '管理员'}</td>
                <td>${user.registerTime}</td>
                <td>${user.status}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">删除</button>
                </td>
            </tr>
        `).join('');
    }

    // 删除预约
    function deleteAppointment(appointmentId) {
        showMessage('预约已删除', 'success');
    }

    // 删除房源
    function deleteHouse(houseId) {
        showMessage('房源已删除', 'success');
    }

    // 删除用户
    function deleteUser(userId) {
        showMessage('用户已删除', 'success');
    }

    // 显示指定section
    function showSection(sectionId) {
        // 隐藏所有section
        document.querySelectorAll('.section').forEach(section => {
            section.style.display = 'none';
        });

        // 显示指定section
        document.getElementById(sectionId).style.display = 'block';

        // 更新导航激活状态
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.classList.remove('active');
        });

        // 如果是导航链接，添加激活状态
        const activeLink = document.querySelector(`.nav-links a[onclick="showSection('${sectionId}')"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', initAdminPage);
</script>
</body>
</html>