<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>房屋租售系统 - 房源详情</title>
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
<header>
    <div class="container">
        <nav>
            <div class="logo">房屋租售系统</div>
            <ul class="nav-links">
                <li><a href="tenant.html">返回首页</a></li>
                <li><span id="username"></span></li>
                <li><a class="btn btn-secondary" href="#" id="logoutBtn">登出</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <!-- 房源详情 -->
    <section id="house-detail" style="margin: 2rem 0;">
        <div class="card">
            <div class="card-body">
                <div id="houseInfo">
                    <!-- 房源信息将通过JavaScript动态生成 -->
                </div>

                <!-- 预约看房按钮 -->
                <div style="margin-top: 2rem; text-align: center;">
                    <button class="btn" onclick="showModal('bookModal')">预约看房</button>
                    <button class="btn btn-heart" id="favoriteBtn" onclick="toggleFavoriteDetail()">收藏</button>
                    <a class="btn btn-secondary" href="tenant.html" style="margin-left: 1rem;">返回列表</a>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- 预约模态框 -->
<div class="modal" id="bookModal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 style="margin-bottom: 1.5rem;">预约看房</h3>

        <form id="bookForm">
            <input id="bookHouseId" name="houseId" type="hidden">

            <div class="form-group">
                <label for="bookTime">预约时间</label>
                <input id="bookTime" name="time" required type="datetime-local">
            </div>

            <div class="form-group">
                <label for="bookLocation">预约地点</label>
                <input id="bookLocation" name="location" placeholder="请输入详细地址或见面地点" required type="text">
            </div>

            <div class="form-group">
                <label for="bookNotes">备注</label>
                <textarea id="bookNotes" name="notes" placeholder="请输入其他需求或备注" rows="3"></textarea>
            </div>

            <button class="btn" style="width: 100%; margin-top: 1rem;" type="submit">提交预约</button>
        </form>
    </div>
</div>

<script src="assets/js/utils.js"></script>
<script>
    // 房源详情页JS
    function initHouseDetailPage() {
        // 获取URL参数
        const urlParams = new URLSearchParams(window.location.search);
        const houseId = parseInt(urlParams.get('id'));
        const action = urlParams.get('action');

        // 加载房源信息
        loadHouseInfo(houseId);

        // 预约表单提交事件
        document.getElementById('bookForm').addEventListener('submit', (e) => {
            e.preventDefault();

            if (!validateForm('bookForm')) {
                showMessage('请填写完整信息', 'error');
                return;
            }

            showMessage('预约提交成功，请等待房东确认', 'success');
            hideModal('bookModal');
            e.target.reset();
        });

        // 如果有预约动作，自动显示预约模态框
        if (action === 'book') {
            setTimeout(() => {
                showModal('bookModal');
            }, 500);
        }
    }

    // 加载房源信息
    function loadHouseInfo(houseId) {
        // 模拟房源数据
        const mockHouses = [
            {
                id: 1,
                title: '阳光小区 3室2厅',
                type: '平层',
                area: 120,
                price: 3500,
                address: '北京市朝阳区阳光路1号',
                image: 'https://picsum.photos/seed/house1/800/500',
                description: '阳光小区位于朝阳区核心地段，交通便利，周边配套设施完善。该房源为3室2厅2卫，南北通透，采光良好，家具家电齐全，拎包即可入住。'
            },
            {
                id: 2,
                title: '幸福家园 2室1厅',
                type: '跃层',
                area: 85,
                price: 2800,
                address: '北京市海淀区幸福路2号',
                image: 'https://picsum.photos/seed/house2/800/500',
                description: '幸福家园是海淀区高品质小区，环境优美，绿化率高。该房源为2室1厅1卫，跃层设计，空间利用率高，适合年轻夫妻或小家庭居住。'
            }
        ];

        // 查找房源
        const house = mockHouses.find(h => h.id === houseId);

        if (!house) {
            document.getElementById('houseInfo').innerHTML = '<p style="text-align: center; color: #666; margin: 2rem 0;">未找到该房源</p>';
            return;
        }

        // 渲染房源信息
        document.getElementById('houseInfo').innerHTML = `
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div>
                    <img src="${house.image}" alt="${house.title}" style="width: 100%; height: auto; border-radius: 8px;">
                </div>
                <div>
                    <h2 style="margin-bottom: 1rem;">${house.title}</h2>
                    <div style="margin-bottom: 1.5rem;">
                        <p style="margin: 0.5rem 0; font-size: 1.1rem;"><strong>户型：</strong>${house.type}</p>
                        <p style="margin: 0.5rem 0; font-size: 1.1rem;"><strong>面积：</strong>${house.area}㎡</p>
                        <p style="margin: 0.5rem 0; font-size: 1.5rem; color: #ff6b6b;"><strong>价格：</strong>¥${house.price}/月</p>
                        <p style="margin: 0.5rem 0; font-size: 1.1rem;"><strong>地址：</strong>${house.address}</p>
                    </div>
                    <div style="margin-top: 2rem;">
                        <h3 style="margin-bottom: 1rem;">房源描述</h3>
                        <p style="line-height: 1.8;">${house.description}</p>
                    </div>
                </div>
            </div>
        `;

        // 设置预约表单中的房源ID
        document.getElementById('bookHouseId').value = house.id;
    }

    // 切换收藏状态
    function toggleFavoriteDetail() {
        const favoriteBtn = document.getElementById('favoriteBtn');
        if (favoriteBtn.classList.contains('favorited')) {
            favoriteBtn.textContent = '收藏';
            favoriteBtn.classList.remove('favorited');
            showMessage('取消收藏成功', 'success');
        } else {
            favoriteBtn.textContent = '取消收藏';
            favoriteBtn.classList.add('favorited');
            showMessage('收藏成功', 'success');
        }
    }

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', () => {
        initHouseDetailPage();
        
        // 初始化模态框
        initModals();
        
        // 登出按钮事件
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
        }
    });
</script>
</body>
</html>